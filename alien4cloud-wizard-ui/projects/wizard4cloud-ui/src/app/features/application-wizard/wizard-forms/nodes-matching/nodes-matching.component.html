<div fxLayout="column" class="w4c-wizard-form">
  <mat-accordion>
    <mat-expansion-panel
      *ngFor="let e of fsmContext.deploymentTopologyDTO.availableSubstitutions.availableSubstitutions | keyvalue;">
      <mat-expansion-panel-header>

        <mat-panel-title xLayout="row" >
          <div fxFlex="10%">
            <mat-icon matTooltip="Node matching" >widgets</mat-icon>
          </div>
          <div fxFlex="40%">
            {{ e.key }}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-radio-group (change)="changeSubstitution(e.key, $event)" aria-label="Select an option" fxLayout="column" [value]="fsmContext.deploymentTopologyDTO.topology.substitutedNodes[e.key]">
        <mat-radio-button *ngFor="let resourceTemplateId of e.value" [value]="resourceTemplateId">
          <!-- TODO: use a shared templateComponent to properly display a node template -->
          {{ fsmContext.deploymentTopologyDTO.availableSubstitutions.substitutionsTemplates[resourceTemplateId].name }}
        </mat-radio-button>
      </mat-radio-group>
    </mat-expansion-panel>

    <mat-expansion-panel
      *ngFor="let e of  fsmContext.deploymentTopologyDTO.availableSubstitutions.availablePoliciesSubstitutions | keyvalue;">
      <mat-expansion-panel-header>
        <mat-panel-title fxLayout="row">
          <div fxFlex="10%">
            <mat-icon  matTooltip="Policy matching">tune</mat-icon>
          </div>
          <div  fxFlex="40%">
            {{ e.key }}
          </div>
        </mat-panel-title>
      </mat-expansion-panel-header>
      <mat-radio-group (change)="changePoliciesSubstitution(e.key, $event)" aria-label="Select an option"
        fxLayout="column" [value]="fsmContext.deploymentTopologyDTO.topology.substitutedPolicies[e.key]">
        <mat-radio-button *ngFor="let resourceTemplateId of e.value" [value]="resourceTemplateId">
          <!-- TODO: use a shared templateComponent to properly display a node template -->
          {{ fsmContext.deploymentTopologyDTO.availableSubstitutions.substitutionsPoliciesTemplates[resourceTemplateId].name }}
        </mat-radio-button>
      </mat-radio-group>
    </mat-expansion-panel>
  </mat-accordion>
</div>
<w4c-wizard-control [fsmContext]="fsmContext" 
                    [forwardFn]="doCompleteMatching.bind(this)">
</w4c-wizard-control>
